<!doctype html>
<html lang="en" data-kind="post" data-slug="lisp-macros-with-guardrails" data-title="Common Lisp Macros With Guardrails" data-summary="Treat macros as compile-time APIs: constrain shape, emit debuggable code, and fail loudly on malformed forms." data-image="assets/images/lisp-macros-with-guardrails.jpg" data-time-min="9" data-category="language-design" data-tags="common-lisp,macros,dsl,tooling" data-published="2026-02-22">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Common Lisp Macros With Guardrails</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  </head>
  <body class="min-h-screen bg-[#050805] font-['IBM_Plex_Mono'] text-[#b8ffc6]">
    <div class="pointer-events-none fixed inset-0 opacity-35" style="background-image: linear-gradient(rgba(30, 95, 40, 0.35) 1px, transparent 1px), linear-gradient(90deg, rgba(30, 95, 40, 0.35) 1px, transparent 1px); background-size: 30px 30px;"></div>

    <def-blog-header>
      <header class="sticky top-0 z-20 border-b border-[#1f5f2a] bg-[#040704]/90 backdrop-blur">
        <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
          <a href="../index.html" class="font-['Space_Grotesk'] text-2xl font-bold uppercase tracking-[0.12em] text-[#8dff9e]">Ami//Devlog</a>
          <nav class="flex items-center gap-6 text-sm font-semibold uppercase tracking-[0.09em] text-[#9de8a8]">
            <a class="hover:text-[#d8ffe0]" href="../index.html">Posts</a>
            <a class="hover:text-[#d8ffe0]" href="../about.html">About</a>
          </nav>
        </div>
      </header>
    </def-blog-header>

    <def-post-shell>
      <blog-header></blog-header>
      <div class="mx-auto max-w-5xl px-6 py-8 md:py-10">
        <article class="border border-[#2b713a] bg-[#061006] p-6 md:p-10">
          <header>
            <p class="text-[11px] uppercase tracking-[0.17em] text-[#7cd88f]"><prop name="date"></prop> Â· <prop name="read" default="quick read"></prop></p>
            <h1 class="mt-2 font-['Space_Grotesk'] text-4xl font-bold uppercase leading-tight text-[#dcffe2] md:text-5xl"><prop name="title"></prop></h1>
            <p class="mt-4 max-w-4xl text-sm leading-7 text-[#a3ebb1]"><prop name="dek" default=""></prop></p>
          </header>
          <div class="mt-8 space-y-6 text-sm leading-7 text-[#b5f9c2]"><slot></slot></div>
          <section class="mt-10 border-t border-[#215c2e] pt-5 text-sm text-[#9fe0ab]"><slot name="afterword"></slot></section>
        </article>
      </div>
    </def-post-shell>

    <def-callout>
      <aside class="border border-[#2f8742] bg-[#081408] p-4 text-[#b9ffca]">
        <p class="text-xs font-semibold uppercase tracking-[0.12em] text-[#7ae88f]"><prop name="title" default="Field note"></prop></p>
        <p class="mt-2 text-sm leading-7"><slot></slot></p>
      </aside>
    </def-callout>

    <post-shell title="Common Lisp Macros With Guardrails" date="February 22, 2026" read="9 min" dek="Macros become dangerous when they are treated as text substitution. I treat them as compile-time APIs with explicit contracts.">
      <img src="../assets/images/lisp-macros-with-guardrails.jpg" alt="Common Lisp logo" class="w-full border border-[#2a6f3a] bg-[#081208] object-cover">

      <p>The best macro systems let you move complexity left, into compile time, where mistakes are cheaper. The worst macro systems create a second hidden language where every debugging session starts with guesswork. The difference is discipline: inputs must be validated, expansion must be predictable, and emitted code must still look like something a teammate can read at 2 AM.</p>
      <p>In Common Lisp, this means destructuring forms early and failing with useful messages. If your macro accepts three clauses, check for exactly three clauses. If it expects keywords, reject unknown keywords. Every unchecked branch is a future production bug disguised as flexibility.</p>

      <callout title="Guardrail pattern">
        Expand to explicit helper functions whenever possible. Keep macro output shallow, and move heavy logic into ordinary functions that are testable with normal tooling.
      </callout>

      <h2 class="font-['Space_Grotesk'] text-2xl font-bold uppercase text-[#d5ffde]">How to keep macro output debuggable</h2>
      <ul class="list-disc space-y-2 pl-6">
        <li>Preserve source-level structure so stack traces still map to intent.</li>
        <li>Use generated symbol naming conventions that are obvious in traces.</li>
        <li>Emit one stable shape per macro arity, not fifteen conditional shapes.</li>
      </ul>

      <p>Once you do this, macros stop being magic and start being leverage. You get domain-specific syntax where it helps, while preserving the boring correctness properties that let teams ship without fear.</p>

      <div slot="afterword">Next dispatch: <a class="font-semibold underline hover:text-[#deffe4]" href="rust-ffi-c-without-footguns.html">Rust FFI Into C Without Footguns</a>.</div>
    </post-shell>
  </body>
</html>
